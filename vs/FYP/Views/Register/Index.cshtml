
@{
    ViewData["Title"] = "Index";
}

<div style="padding:80px 0px; padding-bottom:70px;">
    <div class="row">
        <div class="col-3"></div>
        <div class="col-6">
            <form action="/" onsubmit="return register();">
                <div style="border: 2px dashed black; background-color:#fdd8c7; padding: 20px 80px; padding-bottom:30px;">
                    <div style="text-align: center; font-size: 36px;">Registration</div>
                    <div style="text-align:center; margin-bottom:20px;">Already registered? <a href="/Login">Click here</a> to login.</div>
                    <div style="font-size: 17px;margin-bottom: 5px;">
                        <label for="Email">Email:</label>
                        <input class="form-control" id="Email" type="email" />
                    </div>
                    <div style="font-size: 17px;margin-bottom: 5px;">
                        <label for="FName">First Name:</label>
                        <input class="form-control" id="FName" type="text" />
                    </div>
                    <div style="font-size: 17px;margin-bottom: 5px;">
                        <label for="LName">Last Name:</label>
                        <input class="form-control" id="LName" type="text" />
                    </div>
                    <div style="font-size:17px; margin-bottom:5px;">
                        <label for="Password">Password:</label>
                        <input class="form-control" id="Password" type="password" />
                    </div>
                    <div style="font-size:17px; margin-bottom:20px;">
                        <label for="CPassword">Confirm Password:</label>
                        <input class="form-control" id="CPassword" type="password" />
                    </div>
                    <div style="text-align:center;">
                        <div class="row">
                            <div class="col-1"></div>
                            <div class="col-10">
                                <div id="errorFrame" style="display:none;">
                                    <div id="errorMsg" style="text-align:center !important; padding:1px; margin-bottom:10px; border:1px solid black; background-color:#ff8383;">
                                        Error: Wrong Password
                                    </div>
                                </div>
                            </div>
                            <div class="col-1"></div>
                        </div>
                        <button type="submit" class="btn btn-primary" id="registerButton">Register Now</button>
                    </div>
                </div>
            </form>

        </div>
        <div class="col-3"></div>
    </div>
</div>
<script>
    var registering = false;
    function register() {
    if (!registering) {
        registering = true;
        $('#registerButton').html('<i class="fas fa-spinner fa-spin"></i>');
        $('#registerButton').attr('class', 'btn btn-primary disabled');
        $.ajax({
            url: '/Api/User/Create',
            type: 'POST',
            contentType: "application/json; charset=utf-8",
            dataType: "json",
            async: false,
            data: JSON.stringify({ 'Email': $('#Email').val(), 'Password': $('#Password').val() }),
            success: function (responds) {
                if (responds.result == "OK") {
                    $('#errorFrame').attr('style', 'display:none;')
                    $('#loginButton').html('Logged In');
                    $('#loginButton').attr('class', 'btn btn-success disabled');
                    setTimeout(function () { window.location.replace("/"); }, 2000);
                } else if (responds.result == "FIELD_INCOMPLETE") {
                    $('#loginButton').html('Login Now');
                    $('#errorFrame').removeAttr('style');
                    $('#loginButton').attr('class', 'btn btn-primary');
                    $('#errorMsg').html('Error: Please login with your email and password.')
                    registering = false;
                } else if (responds.result == "USER_NOT_FOUND") {
                    $('#loginButton').html('Login Now');
                    $('#errorFrame').removeAttr('style');
                    $('#loginButton').attr('class', 'btn btn-primary');
                    $('#errorMsg').html('Error: Email/password do not match.')
                    registering = false;
                } else if (responds.result == "PASSWORD_MISMATCH") {
                    $('#loginButton').html('Login Now');
                    $('#errorFrame').removeAttr('style');
                    $('#loginButton').attr('class', 'btn btn-primary');
                    $('#errorMsg').html('Error: Email/password do not match.')
                    registering = false;
                }
            },
            error: function () {
                $('#loginButton').html('Login Now');
            }
        });
        return false;
    }
}
</script>